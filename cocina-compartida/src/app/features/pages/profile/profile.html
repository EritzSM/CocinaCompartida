<div *ngIf="user() as currentUser" class="profile-container">

  <header class="profile-header">
    <img [src]="currentUser.avatar || 'https://via.placeholder.com/150'" [alt]="'Avatar de ' + currentUser.username"
      class="profile-avatar">
    <h1 class="user-name">{{ currentUser.username }}</h1>
    <p *ngIf="currentUser.email" class="user-handle">{{ currentUser.email }}</p>
    
    <!-- Añadir la biografía aquí -->
    <p *ngIf="currentUser.bio" class="user-bio">{{ currentUser.bio }}</p>
    
    <button *ngIf="isOwnProfile()" class="update-profile-btn" (click)="openUpdateProfile()">Actualizar Perfil</button>
  </header>

  <div class="modal-overlay" *ngIf="modalVisible">
    <div class="modal-content-custom">

      <header class="modal-header-custom">
        <h2 class="modal-title">Actualizar Perfil</h2>
        <button class="close-btn" (click)="closeUpdateProfile()">&times;</button>
      </header>

      <div class="modal-body-custom">
        <div class="form-group">
          <label for="username">Nombre de usuario</label>
          <input type="text" id="username" [(ngModel)]="newUsername" class="form-control" />
        </div>

        <div class="form-group">
          <label for="password">Nueva contraseña</label>
          <input type="password" id="password" [(ngModel)]="newPassword" class="form-control"
            placeholder="(Opcional)" />
        </div>

        <div class="form-group">
          <label for="bio">Biografía</label>
          <textarea id="bio" [(ngModel)]="newBio" class="form-control" rows="3"
            placeholder="Cuéntanos un poco sobre ti..."></textarea>
        </div>

        <div class="form-group">
          <label for="avatar">Foto de perfil</label>
          <input type="file" id="avatar" (change)="onAvatarSelected($event)" accept="image/*"
            class="form-control file-input" />
          <div *ngIf="newAvatar" class="avatar-preview">
            <p>Vista previa:</p>
            <img [src]="newAvatar" alt="Vista previa del avatar" class="profile-avatar-preview" />
          </div>
        </div>
      </div>

      <footer class="modal-footer-custom">
        <button class="btn-secondary" (click)="closeUpdateProfile()">Cancelar</button>
        <button class="btn-primary" (click)="saveProfileUpdates()">Guardar Cambios</button>
      </footer>

    </div>
  </div>

  <nav class="profile-tabs">
    <button class="tab-button" [class.active]="activeTab() === 'created'" (click)="selectTab('created')">
      {{ isOwnProfile() ? 'Mis Recetas' : 'Recetas' }}
    </button>
    <button *ngIf="isOwnProfile()" class="tab-button" [class.active]="activeTab() === 'favorites'" (click)="selectTab('favorites')">
      Favoritos
    </button>
  </nav>

  <main class="tab-content">
    <div *ngIf="displayedRecipes().length > 0; else noRecipes" class="recipe-grid">
      <div *ngFor="let recipe of displayedRecipes()" class="recipe-card">
        <img [routerLink]="['/recipe', recipe.id]"
          [src]="recipe.images[0] || 'https://via.placeholder.com/300x200?text=Receta'"
          [alt]="'Imagen de ' + recipe.name" class="recipe-image">
        <div [routerLink]="['/recipe', recipe.id]" class="recipe-info">
          <h3>{{ recipe.name }}</h3>
          <p>Por {{ recipe.user.username }}</p>
          <p class="likes"><i class="fa fa-heart"></i> {{ recipe.likes || 0 }}</p>
        </div>
      </div>
    </div>
    <ng-template #noRecipes>
      <div class="no-recipes-message">
        <p>{{ isOwnProfile() ? 'Aún no tienes' : 'Aún no hay' }} recetas en esta sección.</p>
      </div>
    </ng-template>
  </main>
</div>